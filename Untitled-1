<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fear & Greed Index</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background: #fff;
      font-family: Inter, sans-serif;
    }
    .card {
      width: 420px;
      height: 420px;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      padding: 20px;
    }
    .center-label {
      position: absolute;
      text-align: center;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
    }
    .center-label .num {
      font-size: 58px;
      font-weight: 800;
      color: #111;
      line-height: 1;
    }
    .center-label .status {
      font-size: 18px;
      font-weight: 600;
      margin-top: 6px;
      color: #777;
    }
    .meta {
      position: absolute;
      bottom: 18px;
      font-size: 12px;
      color: #666;
      text-align: center;
      width: 100%;
    }
  </style>
</head>
<body>
  <div class="card">
    <canvas id="fgChart"></canvas>
    <div class="center-label">
      <div class="num" id="fgValue">--</div>
      <div class="status" id="fgStatus">Loading...</div>
    </div>
    <div class="meta" id="fgMeta">Loading...</div>
  </div>

  <script>
    const API_URL = "https://api.alternative.me/fng/?limit=1&format=json";

    // Chart config (tokenomics-style donut)
    const ctx = document.getElementById("fgChart").getContext("2d");
    const fgChart = new Chart(ctx, {
      type: "doughnut",
      data: {
        labels: ["Fear", "Greed"],
        datasets: [{
          data: [50, 50], // dummy initial
          backgroundColor: [
            "#e74c3c", "#2ecc71" // red → green
          ],
          borderWidth: 0,
          hoverOffset: 0,
          spacing: 2,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        cutout: "70%", // donut thickness
        plugins: { legend: { display: false }, tooltip: { enabled: false } },
        animation: { duration: 800, easing: "easeOutQuart" }
      }
    });

    // Classification helper
    function classify(value){
      if (value <= 20) return { text: "Extreme Fear", color: "#e74c3c" };
      if (value <= 40) return { text: "Fear", color: "#ff8a2b" };
      if (value <= 60) return { text: "Neutral", color: "#f1c40f" };
      if (value <= 80) return { text: "Greed", color: "#9acd56" };
      return { text: "Extreme Greed", color: "#2ecc71" };
    }

    async function updateChart(){
      try {
        const res = await fetch(API_URL + "&_=" + Date.now());
        const json = await res.json();
        const item = json.data[0];
        const value = parseInt(item.value, 10);
        const label = classify(value);

        // Update donut values → Fear vs Greed balance
        fgChart.data.datasets[0].data = [100 - value, value];
        fgChart.data.datasets[0].backgroundColor = [
          "#e74c3c", label.color
        ];
        fgChart.update();

        // Update center labels
        document.getElementById("fgValue").textContent = value;
        document.getElementById("fgStatus").textContent = label.text;
        document.getElementById("fgStatus").style.color = label.color;

        // Meta info
        const apiTime = new Date(item.timestamp * 1000).toLocaleString();
        document.getElementById("fgMeta").textContent =
          `Source: alternative.me · Updated: ${apiTime}`;

      } catch (err){
        console.error("Error fetching F&G:", err);
      }
    }

    updateChart();
    setInterval(updateChart, 60000);
  </script>
</body>
</html>
